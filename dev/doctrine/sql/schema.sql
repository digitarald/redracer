CREATE TABLE contributors (id BIGINT UNSIGNED AUTO_INCREMENT, user_id BIGINT UNSIGNED, resource_id BIGINT UNSIGNED, manager TINYINT UNSIGNED DEFAULT 0 NOT NULL, approved TINYINT UNSIGNED DEFAULT 0 NOT NULL, title VARCHAR(50), description TEXT, created_at DATETIME, updated_at DATETIME, INDEX user_idx_idx (user_id), INDEX resource_idx_idx (resource_id), INDEX manager_idx_idx (manager), INDEX approved_idx_idx (approved), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE hits (id BIGINT UNSIGNED AUTO_INCREMENT, user_id BIGINT UNSIGNED, resource_id BIGINT UNSIGNED NOT NULL, created_at DATETIME, updated_at DATETIME, INDEX resource_idx_idx (resource_id), INDEX user_idx_idx (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE licences (id BIGINT UNSIGNED AUTO_INCREMENT, user_id BIGINT UNSIGNED, title VARCHAR(50), abbr VARCHAR(16), url VARCHAR(250), description TEXT, created_at DATETIME, updated_at DATETIME, version BIGINT, INDEX user_idx_idx (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE licence_version (id BIGINT UNSIGNED, user_id BIGINT UNSIGNED, title VARCHAR(50), abbr VARCHAR(16), url VARCHAR(250), description TEXT, created_at DATETIME, updated_at DATETIME, version BIGINT, PRIMARY KEY(id, version)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE links (id BIGINT UNSIGNED AUTO_INCREMENT, user_id BIGINT UNSIGNED, resource_id BIGINT UNSIGNED NOT NULL, category TINYINT UNSIGNED DEFAULT 0 NOT NULL, approved TINYINT UNSIGNED DEFAULT 0 NOT NULL, title VARCHAR(50), description TEXT, url VARCHAR(250), created_at DATETIME, updated_at DATETIME, INDEX category_idx_idx (category), INDEX approved_idx_idx (approved), INDEX user_idx_idx (user_id), INDEX resource_idx_idx (resource_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE resources (id BIGINT UNSIGNED AUTO_INCREMENT, ident VARCHAR(30) UNIQUE, user_id BIGINT UNSIGNED, version BIGINT, approved TINYINT UNSIGNED DEFAULT 0 NOT NULL, category TINYINT UNSIGNED DEFAULT 0 NOT NULL, title VARCHAR(50), description TEXT, readme TEXT, copyright VARCHAR(50), url_feed VARCHAR(250), url_source VARCHAR(250), hits_count BIGINT UNSIGNED DEFAULT 0 NOT NULL, downloads_count BIGINT UNSIGNED DEFAULT 0 NOT NULL, rating_average TINYINT UNSIGNED DEFAULT 0 NOT NULL, ratings_count BIGINT UNSIGNED DEFAULT 0 NOT NULL, created_at DATETIME, updated_at DATETIME, deleted TINYINT(1) DEFAULT '0' NOT NULL, INDEX category_idx_idx (category), INDEX approved_idx_idx (approved), INDEX user_idx_idx (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE resource_version (id BIGINT UNSIGNED, ident VARCHAR(30), user_id BIGINT UNSIGNED, version BIGINT, approved TINYINT UNSIGNED DEFAULT 0 NOT NULL, category TINYINT UNSIGNED DEFAULT 0 NOT NULL, title VARCHAR(50), description TEXT, readme TEXT, copyright VARCHAR(50), url_feed VARCHAR(250), url_source VARCHAR(250), hits_count BIGINT UNSIGNED DEFAULT 0 NOT NULL, downloads_count BIGINT UNSIGNED DEFAULT 0 NOT NULL, rating_average TINYINT UNSIGNED DEFAULT 0 NOT NULL, ratings_count BIGINT UNSIGNED DEFAULT 0 NOT NULL, created_at DATETIME, updated_at DATETIME, deleted TINYINT(1) DEFAULT '0' NOT NULL, PRIMARY KEY(id, version)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE resource_licence_ref (resource_id BIGINT UNSIGNED, licence_id BIGINT UNSIGNED, PRIMARY KEY(resource_id, licence_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE resource_tag_ref (resource_id BIGINT UNSIGNED, tag_id BIGINT UNSIGNED, PRIMARY KEY(resource_id, tag_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE reviews (id BIGINT UNSIGNED AUTO_INCREMENT, user_id BIGINT UNSIGNED, resource_id BIGINT UNSIGNED NOT NULL, rating TINYINT UNSIGNED DEFAULT 0 NOT NULL, approved TINYINT UNSIGNED DEFAULT 0 NOT NULL, title VARCHAR(50), description TEXT, created_at DATETIME, updated_at DATETIME, INDEX resource_idx_idx (resource_id), INDEX user_idx_idx (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE snippet_version (id BIGINT UNSIGNED, resource_id BIGINT UNSIGNED, title VARCHAR(50), description TEXT, language VARCHAR(8), source TEXT, created_at DATETIME, updated_at DATETIME, version BIGINT, INDEX id_idx (id), INDEX resource_id_idx (resource_id), PRIMARY KEY(id, resource_id, version)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE snippet (id BIGINT UNSIGNED AUTO_INCREMENT, resource_id BIGINT UNSIGNED, title VARCHAR(50), description TEXT, language VARCHAR(8), source TEXT, created_at DATETIME, updated_at DATETIME, version BIGINT, PRIMARY KEY(id, resource_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE tags (id BIGINT UNSIGNED AUTO_INCREMENT, word VARCHAR(30) UNIQUE, count BIGINT UNSIGNED DEFAULT 0 NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE users (id BIGINT UNSIGNED AUTO_INCREMENT, status TINYINT UNSIGNED DEFAULT 0 NOT NULL, nickname VARCHAR(250), password TEXT, role VARCHAR(50), email VARCHAR(250), fullname VARCHAR(250), dob DATE, postcode VARCHAR(24), country VARCHAR(2), language VARCHAR(2), timezone VARCHAR(2), github_id VARCHAR(50), paypal_id VARCHAR(50), login_at DATETIME, login_ip VARCHAR(15), created_at DATETIME, updated_at DATETIME, latitude DOUBLE, longitude DOUBLE, INDEX status_idx_idx (status), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE user_auths (id BIGINT UNSIGNED AUTO_INCREMENT, identifier VARCHAR(250) UNIQUE, user_id BIGINT UNSIGNED, created_at DATETIME, updated_at DATETIME, INDEX user_idx_idx (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
CREATE TABLE user_tokens (id BIGINT UNSIGNED AUTO_INCREMENT, token VARCHAR(32) UNIQUE, ip VARCHAR(15), user_id BIGINT UNSIGNED, created_at DATETIME, updated_at DATETIME, INDEX user_idx_idx (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE = INNODB;
ALTER TABLE licence_version ADD FOREIGN KEY (id) REFERENCES licences(id) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE resource_version ADD FOREIGN KEY (id) REFERENCES resources(id) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE snippet_version ADD FOREIGN KEY (id, resource_id) REFERENCES snippet(id, resource_id) ON UPDATE CASCADE ON DELETE CASCADE;
